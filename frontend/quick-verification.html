<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Data Verification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .loading { color: #007bff; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .metric { font-size: 24px; font-weight: bold; color: #005BAC; }
        .label { color: #666; font-size: 14px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Spring Snow Data Verification</h1>
        
        <div class="card">
            <h2>üìä Summary Data</h2>
            <div id="summary-status" class="loading">Loading...</div>
            <div class="data-grid">
                <div>
                    <div class="label">Total Products</div>
                    <div id="total-products" class="metric">--</div>
                </div>
                <div>
                    <div class="label">Days</div>
                    <div id="days" class="metric">--</div>
                </div>
                <div>
                    <div class="label">Total Sales (K)</div>
                    <div id="total-sales" class="metric">--</div>
                </div>
                <div>
                    <div class="label">Production-Sales Ratio (%)</div>
                    <div id="ratio" class="metric">--</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üì¶ Top 5 Inventory</h2>
            <div id="inventory-status" class="loading">Loading...</div>
            <div id="inventory-data"></div>
        </div>

        <div class="card">
            <h2>üìà Production-Sales Ratio Trend (First 5 Days)</h2>
            <div id="ratio-status" class="loading">Loading...</div>
            <div id="ratio-data"></div>
        </div>

        <div class="card">
            <h2>üí∞ Sales-Price Trend (First 5 Days)</h2>
            <div id="price-status" class="loading">Loading...</div>
            <div id="price-data"></div>
        </div>

        <button onclick="refreshAllData()">üîÑ Refresh All Data</button>
        <button onclick="window.open('http://localhost:3000/index.html', '_blank')">üöÄ Open Main System</button>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8787';

        async function fetchData(endpoint) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function loadSummaryData() {
            try {
                const data = await fetchData('/api/summary?start_date=2025-06-01&end_date=2025-06-26');
                
                document.getElementById('total-products').textContent = data.total_products || '--';
                document.getElementById('days').textContent = data.days || '--';
                document.getElementById('total-sales').textContent = ((data.total_sales || 0) / 1000).toFixed(1);
                document.getElementById('ratio').textContent = (data.sales_to_production_ratio || 0).toFixed(1);
                
                document.getElementById('summary-status').innerHTML = '<span class="success">‚úÖ Summary data loaded successfully</span>';
            } catch (error) {
                document.getElementById('summary-status').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function loadInventoryData() {
            try {
                const data = await fetchData('/api/inventory/top?date=2025-06-26&limit=5');
                
                let html = '<table style="width:100%; border-collapse: collapse;">';
                html += '<tr style="background:#f8f9fa;"><th style="padding:8px; text-align:left;">Product</th><th style="padding:8px; text-align:right;">Inventory (T)</th></tr>';
                
                data.forEach(item => {
                    const inventoryT = (item.inventory_level / 1000).toFixed(1);
                    html += `<tr><td style="padding:8px;">${item.product_name}</td><td style="padding:8px; text-align:right;">${inventoryT}T</td></tr>`;
                });
                
                html += '</table>';
                document.getElementById('inventory-data').innerHTML = html;
                document.getElementById('inventory-status').innerHTML = `<span class="success">‚úÖ Loaded ${data.length} inventory records</span>`;
            } catch (error) {
                document.getElementById('inventory-status').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function loadRatioData() {
            try {
                const data = await fetchData('/api/trends/ratio?start_date=2025-06-01&end_date=2025-06-26');
                
                let html = '<table style="width:100%; border-collapse: collapse;">';
                html += '<tr style="background:#f8f9fa;"><th style="padding:8px; text-align:left;">Date</th><th style="padding:8px; text-align:right;">Ratio (%)</th><th style="padding:8px; text-align:center;">Status</th></tr>';
                
                data.slice(0, 5).forEach(item => {
                    const ratio = item.ratio.toFixed(1);
                    const status = item.ratio >= 100 ? 'üü¢ Good' : 'üü° Low';
                    const color = item.ratio >= 100 ? '#28a745' : '#ffc107';
                    html += `<tr><td style="padding:8px;">${item.record_date}</td><td style="padding:8px; text-align:right; color:${color};">${ratio}%</td><td style="padding:8px; text-align:center;">${status}</td></tr>`;
                });
                
                html += '</table>';
                document.getElementById('ratio-data').innerHTML = html;
                document.getElementById('ratio-status').innerHTML = `<span class="success">‚úÖ Loaded ${data.length} ratio records</span>`;
            } catch (error) {
                document.getElementById('ratio-status').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function loadPriceData() {
            try {
                const data = await fetchData('/api/trends/sales-price?start_date=2025-06-01&end_date=2025-06-26');
                
                let html = '<table style="width:100%; border-collapse: collapse;">';
                html += '<tr style="background:#f8f9fa;"><th style="padding:8px; text-align:left;">Date</th><th style="padding:8px; text-align:right;">Sales (T)</th><th style="padding:8px; text-align:right;">Avg Price (¬•/T)</th></tr>';
                
                data.slice(0, 5).forEach(item => {
                    const salesT = (item.total_sales / 1000).toFixed(1);
                    const price = item.avg_price.toFixed(0);
                    html += `<tr><td style="padding:8px;">${item.record_date}</td><td style="padding:8px; text-align:right;">${salesT}T</td><td style="padding:8px; text-align:right;">¬•${price}</td></tr>`;
                });
                
                html += '</table>';
                document.getElementById('price-data').innerHTML = html;
                document.getElementById('price-status').innerHTML = `<span class="success">‚úÖ Loaded ${data.length} price records</span>`;
            } catch (error) {
                document.getElementById('price-status').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }

        async function refreshAllData() {
            await Promise.all([
                loadSummaryData(),
                loadInventoryData(),
                loadRatioData(),
                loadPriceData()
            ]);
        }

        // Auto-load data on page load
        window.addEventListener('load', () => {
            setTimeout(refreshAllData, 500);
        });
    </script>
</body>
</html>
