# 春雪食品产销分析系统测试策略文档

## 1. 概述

本文档基于实际完成的系统测试经验，详细描述了春雪食品产销分析系统的全面测试策略。我们采用分层测试方法，覆盖从数据导入到前端展示的完整流程，确保系统的质量、稳定性和可靠性。

### 1.1 测试目标
- **功能完整性**: 验证所有核心功能正常工作
- **数据准确性**: 确保数据导入、处理和展示的准确性
- **用户体验**: 保证前端交互流畅、直观
- **性能稳定性**: 验证系统在正常负载下的性能表现
- **错误处理**: 确保异常情况下的优雅降级

### 1.2 测试环境
- **本地开发环境**: 用于日常开发和调试
- **本地集成环境**: 模拟生产环境的完整测试
- **Cloudflare预发布环境**: 生产部署前的最终验证

## 2. 数据导入测试 (优先级最高)

数据导入是系统的基础，必须确保数据的完整性和准确性。

### 2.1 Excel文件格式验证

**测试目标**: 验证Excel文件读取和解析的正确性

**测试步骤**:
1. **文件存在性检查**
   ```bash
   ls Excel文件夹/
   # 验证: 产成品入库列表.xlsx, 收发存汇总表查询.xlsx, 销售发票执行查询.xlsx
   ```

2. **列结构验证**
   ```bash
   python3 data_importer.py
   # 检查输出中的列信息是否正确
   ```

3. **数据类型检查**
   - 日期列: 确保可以正确解析为 YYYY-MM-DD 格式
   - 数值列: 确保数值类型正确，NaN值被正确处理
   - 文本列: 确保产品名称一致性

**预期结果**:
- 生产数据: ~20,000条记录
- 销售数据: ~18,000条记录
- 库存数据: ~400条产品，扩展为多日期记录
- 最终有效记录: ~10,000条

### 2.2 数据质量验证

**关键指标检查**:
- **库存数据**: 确保inventory_level不全为0
- **价格数据**: 确保average_price不全为0
- **日期覆盖**: 确保数据覆盖完整的分析周期
- **产品匹配**: 确保产品名称在各文件间一致

## 3. 后端API测试

### 3.1 环境准备

**启动后端服务**:
```bash
cd backend
npm run dev
# 验证服务运行在 http://localhost:8787
```

### 3.2 API端点功能测试

#### 3.2.1 产品管理API
```bash
# 测试产品列表
curl -s "http://localhost:8787/api/products?limit=5"
# 预期: 返回产品数组，包含product_id, product_name等字段
```

#### 3.2.2 汇总数据API
```bash
# 测试汇总统计
curl -s "http://localhost:8787/api/summary?start_date=2025-06-01&end_date=2025-06-26"
# 预期: 返回total_products, total_sales, production_sales_ratio等
```

#### 3.2.3 库存排行API
```bash
# 测试库存TOP排行
curl -s "http://localhost:8787/api/inventory/top?date=2025-06-01&limit=5"
# 预期: 返回库存排行数组，inventory_level应为非零值
```

#### 3.2.4 趋势分析API
```bash
# 测试销售价格趋势
curl -s "http://localhost:8787/api/trends/sales-price?start_date=2025-06-01&end_date=2025-06-05"
# 预期: 返回日期序列，avg_price应为非零值

# 测试产销比趋势
curl -s "http://localhost:8787/api/trends/ratio?start_date=2025-06-01&end_date=2025-06-05"
# 预期: 返回日期序列，ratio应在合理范围内(0-200%)
```

### 3.3 错误处理测试

**参数验证测试**:
```bash
# 缺少必需参数
curl -s "http://localhost:8787/api/summary"
# 预期: 返回错误信息

# 无效日期格式
curl -s "http://localhost:8787/api/summary?start_date=invalid&end_date=2025-06-26"
# 预期: 返回错误信息或空数据
```

### 3.4 性能测试

**响应时间验证**:
- 所有API响应时间应 < 500ms
- 大数据量查询应 < 2秒
- 并发请求处理能力验证

## 3. 前端测试

前端测试的重点是验证用户交互和数据可视化的正确性。

### 3.1. 手动测试 (Manual Testing)

*   **目标:** 确保核心用户流程顺畅，UI在各种场景下表现正常。
*   **范围:**
    *   **交互流程测试:**
        *   打开页面，验证图表是否使用默认日期范围正确加载。
        *   操作日期选择器，点击“查询”，验证所有图表和摘要卡片是否同步更新。
        *   验证加载状态提示是否正常显示和消失。
    *   **UI兼容性测试:** 在主流浏览器（Chrome, Firefox, Safari）上检查页面布局和图表渲染是否一致。
    *   **数据上传测试:**
        *   上传一个格式正确的Excel文件，验证数据是否成功导入并反映在图表中。
        *   上传一个格式错误或空的文件，验证是否显示友好的错误提示。

### 3.2. 端到端测试 (End-to-End, E2E) - (未来扩展)

*   **目标:** 自动化地模拟真实用户操作，从UI交互到后端API调用再到数据库，贯穿整个技术栈进行测试。
*   **工具:** Playwright 或 Cypress。
*   **场景示例:**
    1.  启动应用。
    2.  断言页面标题正确。
    3.  找到日期输入框，输入新的日期。
    4.  点击“查询”按钮。
    5.  等待网络请求完成。
    6.  断言图表中的某个元素（如Legend）已经更新，以反映新的数据。

## 4. 部署前检查

在每次部署到生产环境之前，执行以下步骤：

1.  在本地运行所有后端测试 (`npm test`) 并确保全部通过。
2.  将代码部署到Cloudflare的预发布（Staging）环境。
3.  在预发布环境中进行一轮核心功能的手动测试，作为最终的冒烟测试（Smoke Test）。
4.  确认无误后，才将预发布版本推向生产环境。
