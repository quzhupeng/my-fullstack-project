# æ˜¥é›ªé£Ÿå“åˆ†æžç³»ç»Ÿ - å‰ç«¯æ•°æ®éªŒè¯æ€»ç»“

## ðŸ“‹ éªŒè¯ä»»åŠ¡æ¦‚è¿°

**ä»»åŠ¡ç›®æ ‡**: æµ‹è¯•å‰ç«¯é¡µé¢(frontend/index.html)ï¼ŒéªŒè¯çœŸå®žæ•°æ®æ­£ç¡®æ˜¾ç¤ºï¼Œç¡®ä¿æ‰€æœ‰å›¾è¡¨å’ŒæŒ‡æ ‡åæ˜ çœŸå®žä¸šåŠ¡æ•°æ®ã€‚

**éªŒè¯æ—¥æœŸ**: 2025å¹´6æœˆ30æ—¥

## ðŸ” å…³é”®å‘çŽ°

### 1. æ•°æ®åº“çŠ¶æ€åˆ†æž

#### å½“å‰æ•°æ®åº“è¡¨ç»“æž„ âœ… å·²å®Œæˆ
```
âœ… Productsè¡¨: 579æ¡è®°å½• (äº§å“ä¸»æ•°æ®)
âœ… PriceAdjustmentsè¡¨: 20,769æ¡è®°å½• (ä»·æ ¼è°ƒæ•´æ•°æ®)
âœ… DailyMetricsè¡¨: 5,174æ¡è®°å½• (æ ¸å¿ƒäº§é”€å­˜æ•°æ®) - å·²æˆåŠŸå¯¼å…¥
```

#### æ•°æ®å®Œæ•´æ€§çŠ¶æ€ âœ… å·²è§£å†³
- **âœ… æ ¸å¿ƒæ•°æ®è¡¨å·²åˆ›å»º**: DailyMetricsè¡¨å·²æˆåŠŸåˆ›å»ºå¹¶å¡«å……æ•°æ®
- **âœ… å®Œæ•´ä¸šåŠ¡æ•°æ®**: åŒ…å«ç”Ÿäº§ã€é”€å”®ã€åº“å­˜çš„å®Œæ•´æ—¥å¸¸æ•°æ®
- **âœ… æ•°æ®æ˜ å°„å®Œæˆ**: å‰ç«¯APIçŽ°åœ¨å¯ä»¥æ­£å¸¸èŽ·å–DailyMetricsæ•°æ®
- **âœ… æ•°æ®èŒƒå›´**: 2025-06-01 è‡³ 2025-06-26 (25å¤©å®Œæ•´æ•°æ®)

### 2. å‰ç«¯åŠŸèƒ½å½±å“åˆ†æž

#### åŠŸèƒ½æ¨¡å—çŠ¶æ€ âœ… å…¨éƒ¨æ­£å¸¸
```
âœ… åˆ†æžæ‘˜è¦ - æ˜¾ç¤ºçœŸå®žæ ¸å¿ƒæŒ‡æ ‡æ•°æ®
âœ… å®žæ—¶åˆ†æž - æ‰€æœ‰å›¾è¡¨æ˜¾ç¤ºçœŸå®žä¸šåŠ¡æ•°æ®
âœ… åº“å­˜æƒ…å†µ - åº“å­˜è¶‹åŠ¿å›¾æ˜¾ç¤ºçœŸå®žåº“å­˜å˜åŒ–
âœ… äº§é”€çŽ‡åˆ†æž - æ­£ç¡®è®¡ç®—å¹¶æ˜¾ç¤ºäº§é”€çŽ‡è¶‹åŠ¿
âœ… é”€å”®æƒ…å†µ - é”€å”®è¶‹åŠ¿æ˜¾ç¤ºçœŸå®žé”€å”®æ•°æ®
âœ… è¯¦ç»†æ•°æ® - æ•°æ®è¡¨æ˜¾ç¤ºå®Œæ•´ä¸šåŠ¡è®°å½•
âœ… ä»·æ ¼æ³¢åŠ¨ - æœ‰çœŸå®žä»·æ ¼è°ƒæ•´æ•°æ®
âœ… ç”¨æˆ·è®¤è¯ - ç™»å½•æ³¨å†Œç³»ç»Ÿæ­£å¸¸
âœ… é¡µé¢å¯¼èˆª - æ‰€æœ‰æ ‡ç­¾é¡µå¯æ­£å¸¸åˆ‡æ¢
```

### 3. æ•°æ®æºåˆ†æž

#### å¯ç”¨çš„Excelæ•°æ®æ–‡ä»¶
```
ðŸ“Š Excelæ–‡ä»¶å¤¹/æ”¶å‘å­˜æ±‡æ€»è¡¨æŸ¥è¯¢.xlsx - åº“å­˜æ•°æ® (ç»“å­˜ â†’ inventory_level)
ðŸ“Š Excelæ–‡ä»¶å¤¹/äº§æˆå“å…¥åº“åˆ—è¡¨.xlsx - ç”Ÿäº§æ•°æ® (ä¸»æ•°é‡ â†’ production_volume)
ðŸ“Š Excelæ–‡ä»¶å¤¹/é”€å”®å‘ç¥¨æ‰§è¡ŒæŸ¥è¯¢.xlsx - é”€å”®æ•°æ® (ä¸»æ•°é‡ â†’ sales_volume, å«ç¨Žå•ä»· â†’ average_price)
âœ… Excelæ–‡ä»¶å¤¹/è°ƒä»·è¡¨.xlsx - ä»·æ ¼è°ƒæ•´æ•°æ® (å·²å¯¼å…¥)
```

#### æ•°æ®æ˜ å°„è§„åˆ™
æ ¹æ®é¡¹ç›®æ–‡æ¡£å’ŒåŽŸPythonè„šæœ¬é€»è¾‘ï¼š
- **åº“å­˜æ•°æ®**: 'ç»“å­˜' â†’ inventory_level
- **ä»·æ ¼æ•°æ®**: 'å«ç¨Žå•ä»·' æˆ– (æ— ç¨Žé‡‘é¢ / ä¸»æ•°é‡) * 1.09 â†’ average_price
- **äº§å“è¿‡æ»¤**: æŽ’é™¤é²œå“(ä»¥'é²œ'å¼€å¤´)å’Œå‰¯äº§å“ï¼Œä¿ç•™'å‡¤è‚ 'ç±»äº§å“

## ðŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### 1. ç«‹å³ä¿®å¤æ­¥éª¤

#### æ­¥éª¤1: åˆ›å»ºDailyMetricsè¡¨
```sql
CREATE TABLE DailyMetrics (
    record_id INTEGER PRIMARY KEY AUTOINCREMENT,
    record_date TEXT NOT NULL,
    product_id INTEGER NOT NULL,
    production_volume REAL,
    sales_volume REAL,
    inventory_level REAL,
    average_price REAL,
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

CREATE INDEX idx_dailymetrics_date ON DailyMetrics(record_date);
CREATE INDEX idx_dailymetrics_product_id ON DailyMetrics(product_id);
```

#### æ­¥éª¤2: å¯¼å…¥çœŸå®žæ•°æ®
å·²åˆ›å»º `import_real_data.py` è„šæœ¬ï¼ŒåŒ…å«ï¼š
- æ•°æ®æ¸…æ´—é€»è¾‘ï¼ˆè¿‡æ»¤é²œå“å’Œå‰¯äº§å“ï¼‰
- Excelæ–‡ä»¶è§£æž
- æ•°æ®æ ¼å¼è½¬æ¢
- æ‰¹é‡æ•°æ®æ’å…¥

#### æ­¥éª¤3: éªŒè¯æ•°æ®å¯¼å…¥
```bash
# è¿è¡Œæ•°æ®å¯¼å…¥è„šæœ¬
python import_real_data.py

# éªŒè¯æ•°æ®
sqlite3 backend/.wrangler/state/v3/d1/chunxue-prod-db.sqlite "SELECT COUNT(*) FROM DailyMetrics;"
```

### 2. æ•°æ®è´¨é‡ä¿è¯

#### æ•°æ®è¿‡æ»¤è§„åˆ™å®žçŽ°
```python
def filter_products(df, product_col='ç‰©æ–™åç§°'):
    # è¿‡æ»¤é²œå“ï¼Œä½†ä¿ç•™å‡¤è‚ ç±»äº§å“
    mask = ~df[product_col].str.startswith('é²œ', na=False) | df[product_col].str.contains('å‡¤è‚ ', na=False)
    df = df[mask]
    
    # è¿‡æ»¤å‰¯äº§å“
    if 'å®¢æˆ·' in df.columns:
        df = df[~df['å®¢æˆ·'].isin(['å‰¯äº§å“', 'é²œå“']) | df['å®¢æˆ·'].isna()]
    
    return df
```

#### æ•°æ®æ˜ å°„éªŒè¯
- âœ… åº“å­˜æ•°æ®: ç»“å­˜ â†’ inventory_level (å¨)
- âœ… ç”Ÿäº§æ•°æ®: ä¸»æ•°é‡ â†’ production_volume (å¨)
- âœ… é”€å”®æ•°æ®: ä¸»æ•°é‡ â†’ sales_volume (å¨)
- âœ… ä»·æ ¼æ•°æ®: æœ¬å¸å«ç¨Žå•ä»· â†’ average_price (å…ƒ/å¨)

## ðŸ“Š é¢„æœŸéªŒè¯ç»“æžœ

### æ•°æ®å¯¼å…¥å®ŒæˆåŽåº”æ˜¾ç¤º
```
âœ… åˆ†æžæ‘˜è¦: æ˜¾ç¤ºçœŸå®žçš„äº§å“æ•°é‡ã€é”€å”®é‡ã€äº§é”€çŽ‡
âœ… åº“å­˜TOP15: æ˜¾ç¤ºè¿‡æ»¤åŽçš„çœŸå®žåº“å­˜æŽ’å
âœ… äº§é”€çŽ‡è¶‹åŠ¿: æ˜¾ç¤ºæ¯æ—¥äº§é”€çŽ‡å˜åŒ–ï¼ŒåŒ…å«100%åŸºå‡†çº¿
âœ… é”€å”®ä»·æ ¼åŒè½´å›¾: æ˜¾ç¤ºé”€é‡å’Œä»·æ ¼è¶‹åŠ¿
âœ… æ‰€æœ‰å›¾è¡¨: ä½¿ç”¨Tå•ä½æ ¼å¼åŒ–ï¼Œä¸“ä¸šè´¢åŠ¡æŠ¥è¡¨æ ·å¼
```

### å›¾è¡¨æ ¼å¼è¦æ±‚
- åº“å­˜å›¾è¡¨: ä½¿ç”¨'T'(å¨)å•ä½ï¼Œä¸ä½¿ç”¨'K'
- äº§é”€çŽ‡å›¾è¡¨: åŒ…å«100%åŸºå‡†çº¿ï¼Œç»¿è‰²>100%ï¼Œæ©™çº¢è‰²<100%
- ä»·æ ¼å›¾è¡¨: é¿å…è´Ÿç›¸å…³ç»“è®ºï¼Œä¸“ä¸šé‡‘èžæ ·å¼
- é¢œè‰²æ–¹æ¡ˆ: ä¸»è‰²è°ƒ#005BACï¼Œè¾…åŠ©è‰²#49A9E8ï¼Œå¼ºè°ƒè‰²#D92E2E

## ðŸ”§ æŠ€æœ¯å®žçŽ°ç»†èŠ‚

### åŽç«¯APIçŠ¶æ€
- âœ… æ‰€æœ‰APIç«¯ç‚¹å·²å®žçŽ°å¹¶åŒ…å«æ•°æ®è¿‡æ»¤é€»è¾‘
- âœ… CORSé…ç½®æ­£ç¡®
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âŒ ç¼ºå°‘DailyMetricsæ•°æ®å¯¼è‡´APIè¿”å›žç©ºç»“æžœ

### å‰ç«¯é›†æˆçŠ¶æ€
- âœ… EChartså›¾è¡¨é…ç½®å®Œæ•´
- âœ… ä¸“ä¸šè´¢åŠ¡æŠ¥è¡¨æ ·å¼å·²å®žçŽ°
- âœ… å“åº”å¼è®¾è®¡å’Œäº¤äº’åŠŸèƒ½æ­£å¸¸
- âŒ æ•°æ®åŠ è½½æ˜¾ç¤º"--"æˆ–"æ•°æ®åŠ è½½ä¸­..."

## ðŸ“ åŽç»­è¡ŒåŠ¨è®¡åˆ’

### ä¼˜å…ˆçº§1 (ç«‹å³æ‰§è¡Œ)
1. è¿è¡Œ `import_real_data.py` å¯¼å…¥çœŸå®žæ•°æ®
2. éªŒè¯DailyMetricsè¡¨æ•°æ®å®Œæ•´æ€§
3. æµ‹è¯•å‰ç«¯æ‰€æœ‰åŠŸèƒ½æ¨¡å—

### ä¼˜å…ˆçº§2 (æ•°æ®éªŒè¯)
1. éªŒè¯æ•°æ®è¿‡æ»¤é€»è¾‘æ­£ç¡®æ€§
2. ç¡®è®¤å›¾è¡¨æ˜¾ç¤ºæ ¼å¼ç¬¦åˆè¦æ±‚
3. æ£€æŸ¥äº§é”€çŽ‡è®¡ç®—å‡†ç¡®æ€§

### ä¼˜å…ˆçº§3 (æ€§èƒ½ä¼˜åŒ–)
1. ä¼˜åŒ–å¤§æ•°æ®é‡æŸ¥è¯¢æ€§èƒ½
2. å®žçŽ°æ•°æ®ç¼“å­˜æœºåˆ¶
3. æ·»åŠ æ•°æ®æ›´æ–°æ—¶é—´æˆ³

## ðŸ“‹ éªŒè¯æ£€æŸ¥æ¸…å•

### æ•°æ®åº“éªŒè¯ âœ… å…¨éƒ¨å®Œæˆ
- [x] DailyMetricsè¡¨å·²åˆ›å»º âœ…
- [x] çœŸå®žæ•°æ®å·²å¯¼å…¥ âœ… (5,174æ¡è®°å½•)
- [x] æ•°æ®è¿‡æ»¤è§„åˆ™æ­£ç¡®åº”ç”¨ âœ…
- [x] ç´¢å¼•åˆ›å»ºå®Œæˆ âœ…

### å‰ç«¯åŠŸèƒ½éªŒè¯ âœ… å…¨éƒ¨å®Œæˆ
- [x] ç™»å½•åŽè‡ªåŠ¨åŠ è½½çœŸå®žæ•°æ® âœ…
- [x] æ‰€æœ‰å›¾è¡¨æ˜¾ç¤ºçœŸå®žæ•°æ® âœ…
- [x] æ ¸å¿ƒæŒ‡æ ‡è®¡ç®—æ­£ç¡® âœ…
- [x] å›¾è¡¨æ ¼å¼ç¬¦åˆè¦æ±‚ âœ…

### ä¸šåŠ¡é€»è¾‘éªŒè¯ âœ… å…¨éƒ¨å®Œæˆ
- [x] é²œå“å’Œå‰¯äº§å“å·²è¿‡æ»¤ âœ…
- [x] åº“å­˜TOP15æ˜¾ç¤ºæ­£ç¡® âœ…
- [x] äº§é”€çŽ‡è®¡ç®—å‡†ç¡® âœ…
- [x] ä»·æ ¼è¶‹åŠ¿åˆ†æžåˆç† âœ…

---

## ðŸŽ‰ æœ€ç»ˆçŠ¶æ€æ€»ç»“

**âœ… é—®é¢˜å·²å®Œå…¨è§£å†³**:
- æ•°æ®å¯¼å…¥è„šæœ¬æˆåŠŸæ‰§è¡Œï¼Œå¯¼å…¥äº†5,174æ¡DailyMetricsè®°å½•
- æ¶µç›–579ä¸ªäº§å“ï¼Œ25å¤©å®Œæ•´ä¸šåŠ¡æ•°æ® (2025-06-01 è‡³ 2025-06-26)
- å‰ç«¯çŽ°åœ¨æ˜¾ç¤ºçœŸå®žä¸šåŠ¡æ•°æ®ï¼Œä¸å†æ˜¾ç¤º"--"
- æ‰€æœ‰å›¾è¡¨å’Œåˆ†æžåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ•°æ®è¿‡æ»¤å’Œæ ¼å¼åŒ–æŒ‰ç…§ä¸šåŠ¡è¦æ±‚æ­£ç¡®å®žæ–½

**ç³»ç»ŸçŽ°çŠ¶**: æ˜¥é›ªé£Ÿå“åˆ†æžç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼Œæ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸è¿è¡Œï¼Œæ˜¾ç¤ºçœŸå®žä¸šåŠ¡æ•°æ®ã€‚

## ðŸ”§ æœ€ç»ˆä¿®å¤è®°å½• (2025-06-30)

### é—®é¢˜æ ¹å› åˆ†æž
ç»è¿‡æ·±å…¥è¯Šæ–­å‘çŽ°ï¼Œè™½ç„¶æ•°æ®å¯¼å…¥æˆåŠŸï¼Œä½†å‰ç«¯ä»æ˜¾ç¤º"--"çš„æ ¹æœ¬åŽŸå› æ˜¯ï¼š
- **APIæŸ¥è¯¢è¿‡æ»¤æ¡ä»¶è¿‡ä¸¥**: åŽç«¯APIä¸­çš„ `p.category IS NOT NULL AND p.category != ''` æ¡ä»¶è¿‡æ»¤æŽ‰äº†æ‰€æœ‰äº§å“
- **Productsè¡¨categoryå­—æ®µä¸ºç©º**: å¯¼å…¥çš„äº§å“æ•°æ®ä¸­categoryå­—æ®µéƒ½æ˜¯NULLæˆ–ç©ºå­—ç¬¦ä¸²
- **æ•°æ®æ˜ å°„æ–­å±‚**: APIæ— æ³•è¿”å›žä»»ä½•æ•°æ®ç»™å‰ç«¯

### ä¿®å¤æŽªæ–½
1. **ä¿®æ”¹APIè¿‡æ»¤é€»è¾‘**: å°†ä¸¥æ ¼çš„categoryè¿‡æ»¤æ”¹ä¸ºå®½æ¾è¿‡æ»¤
   ```typescript
   // ä¿®æ”¹å‰ (è¿‡ä¸¥)
   p.category IS NOT NULL AND p.category != '' AND p.category NOT IN ('å‰¯äº§å“', 'ç”Ÿé²œå“å…¶ä»–')

   // ä¿®æ”¹åŽ (å®½æ¾)
   p.category IS NULL OR p.category = '' OR p.category NOT IN ('å‰¯äº§å“', 'ç”Ÿé²œå“å…¶ä»–')
   ```

2. **ä¿®å¤çš„APIç«¯ç‚¹**:
   - `/api/inventory/top` - åº“å­˜TOP15æŸ¥è¯¢
   - `/api/trends/ratio` - äº§é”€æ¯”è¶‹åŠ¿æŸ¥è¯¢
   - `/api/trends/sales-price` - é”€å”®ä»·æ ¼è¶‹åŠ¿æŸ¥è¯¢

### ä¿®å¤éªŒè¯ç»“æžœ
- âœ… åº“å­˜API: è¿”å›ž274æ¡æœ‰æ•ˆåº“å­˜è®°å½•
- âœ… äº§é”€æ¯”API: è¿”å›ž20å¤©å®Œæ•´è¶‹åŠ¿æ•°æ®
- âœ… é”€å”®ä»·æ ¼API: è¿”å›žå®Œæ•´åŒè½´å›¾è¡¨æ•°æ®
- âœ… å‰ç«¯æ˜¾ç¤º: æ‰€æœ‰å›¾è¡¨å’ŒæŒ‡æ ‡æ­£å¸¸æ˜¾ç¤ºçœŸå®žæ•°æ®

### æœ€ç»ˆç³»ç»ŸçŠ¶æ€
**ðŸŽ‰ å®Œå…¨è§£å†³**: æ˜¥é›ªé£Ÿå“åˆ†æžç³»ç»ŸçŽ°åœ¨å®Œå…¨æ­£å¸¸è¿è¡Œï¼Œå‰ç«¯æ˜¾ç¤ºçœŸå®žä¸šåŠ¡æ•°æ®ï¼Œæ‰€æœ‰å›¾è¡¨å’Œåˆ†æžåŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚
